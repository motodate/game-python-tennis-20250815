# チケット: CPU操作ロジック

## 概要
CPUが操作するパドルのAIロジックを実装する。ボールを追従し、速度制限により難易度を調整する。

## 実装内容
- ボールのY座標を追従する基本AI
- CPUの最大移動速度制限（ボールY速度の85%）
- スムーズな動作のための補間処理

## ToDo（TDD実装順）

### 1. CPUControllerクラスのテストを作成
- [ ] tests/test_cpu_controller.pyを作成
- [ ] CPUControllerクラスの存在テストを記述
- [ ] テストを実行して失敗することを確認

### 2. CPUControllerクラスの基本実装
- [ ] src/game/ai/__init__.pyを作成
- [ ] src/game/ai/cpu_controller.pyを作成
- [ ] CPUControllerクラスを定義
- [ ] __init__メソッドでパドルの参照を保持
- [ ] テストを実行して成功することを確認

### 3. ボール追従のテストを作成
- [ ] calculate_target_y()メソッドのテストを追加
- [ ] ボールのY座標を返すことのテストを追加
- [ ] パドル中心を目標とすることのテストを追加
- [ ] テストを実行して失敗することを確認

### 4. ボール追従を実装
- [ ] calculate_target_y(ball)メソッドを実装
- [ ] ボールの中心Y座標を取得
- [ ] パドルの高さの半分を考慮した目標位置を計算
- [ ] テストを実行して成功することを確認

### 5. 移動方向決定のテストを作成
- [ ] get_movement_direction()メソッドのテストを追加
- [ ] ボールが上にある時-1を返すテストを追加
- [ ] ボールが下にある時1を返すテストを追加
- [ ] 同じ位置の時0を返すテストを追加
- [ ] テストを実行して失敗することを確認

### 6. 移動方向決定を実装
- [ ] get_movement_direction(ball)メソッドを実装
- [ ] target_y - current_yの差分を計算
- [ ] 差分の符号に基づいて-1, 0, 1を返す
- [ ] デッドゾーン（±5ピクセル）を設定
- [ ] テストを実行して成功することを確認

### 7. 速度制限のテストを作成
- [ ] calculate_max_speed()メソッドのテストを追加
- [ ] ボールY速度の85%を返すテストを追加
- [ ] 最小速度保証のテストを追加
- [ ] テストを実行して失敗することを確認

### 8. 速度制限を実装
- [ ] calculate_max_speed(ball)メソッドを実装
- [ ] SPEED_FACTOR = 0.85を定義
- [ ] abs(ball.vy) * SPEED_FACTORを計算
- [ ] MIN_SPEED = 100で最小速度を保証
- [ ] テストを実行して成功することを確認

### 9. 更新処理のテストを作成
- [ ] update()メソッドのテストを追加
- [ ] パドルが正しい方向に移動することのテストを追加
- [ ] 速度制限が適用されることのテストを追加
- [ ] テストを実行して失敗することを確認

### 10. 更新処理を実装
- [ ] update(ball, delta_time)メソッドを実装
- [ ] get_movement_direction()で方向を取得
- [ ] calculate_max_speed()で最大速度を取得
- [ ] paddle.move_up/down()を呼び出し
- [ ] テストを実行して成功することを確認

### 11. 予測機能のテストを作成（オプション）
- [ ] predict_ball_position()メソッドのテストを追加
- [ ] 将来のボール位置予測テストを追加
- [ ] テストを実行して失敗することを確認

### 12. 予測機能を実装（オプション）
- [ ] predict_ball_position(ball, time_ahead)メソッドを実装
- [ ] 現在の速度から将来位置を計算
- [ ] 壁反射を考慮した予測を実装
- [ ] テストを実行して成功することを確認

### 13. 難易度調整のテストを作成
- [ ] set_difficulty()メソッドのテストを追加
- [ ] EASY/NORMAL/HARDレベルのテストを追加
- [ ] テストを実行して失敗することを確認

### 14. 難易度調整を実装
- [ ] set_difficulty(level)メソッドを実装
- [ ] DifficultyLevel列挙型を定義
- [ ] レベルに応じてSPEED_FACTORを調整（0.7/0.85/1.0）
- [ ] 全テストを実行して成功することを確認

## 完了条件
- [ ] CPUパドルがボールを自動追従する
- [ ] 速度制限により適度な難易度になる
- [ ] スムーズで自然な動きをする
- [ ] pytest tests/test_cpu_controller.pyが全てパスする