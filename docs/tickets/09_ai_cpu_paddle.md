# チケット: CPU操作ロジック

## 概要
CPUが操作するパドルのAIロジックを実装する。ボールを追従し、速度制限により難易度を調整する。

## 実装内容
- ボールのY座標を追従する基本AI
- CPUの最大移動速度制限（ボールY速度の85%）
- スムーズな動作のための補間処理

## ToDo（TDD実装順）

### 1. CPUControllerクラスのテストを作成
- [x] tests/test_cpu_controller.pyを作成
- [x] CPUControllerクラスの存在テストを記述
- [x] テストを実行して失敗することを確認

### 2. CPUControllerクラスの基本実装
- [x] src/game/ai/__init__.pyを作成
- [x] src/game/ai/cpu_controller.pyを作成
- [x] CPUControllerクラスを定義
- [x] __init__メソッドでパドルの参照を保持
- [x] テストを実行して成功することを確認

### 3. ボール追従のテストを作成
- [x] calculate_target_y()メソッドのテストを追加
- [x] ボールのY座標を返すことのテストを追加
- [x] パドル中心を目標とすることのテストを追加
- [x] テストを実行して失敗することを確認

### 4. ボール追従を実装
- [x] calculate_target_y(ball)メソッドを実装
- [x] ボールの中心Y座標を取得
- [x] パドルの高さの半分を考慮した目標位置を計算
- [x] テストを実行して成功することを確認

### 5. 移動方向決定のテストを作成
- [x] get_movement_direction()メソッドのテストを追加
- [x] ボールが上にある時-1を返すテストを追加
- [x] ボールが下にある時1を返すテストを追加
- [x] 同じ位置の時0を返すテストを追加
- [x] テストを実行して失敗することを確認

### 6. 移動方向決定を実装
- [x] get_movement_direction(ball)メソッドを実装
- [x] target_y - current_yの差分を計算
- [x] 差分の符号に基づいて-1, 0, 1を返す
- [x] デッドゾーン（±5ピクセル）を設定
- [x] テストを実行して成功することを確認

### 7. 速度制限のテストを作成
- [x] calculate_max_speed()メソッドのテストを追加
- [x] ボールY速度の85%を返すテストを追加
- [x] 最小速度保証のテストを追加
- [x] テストを実行して失敗することを確認

### 8. 速度制限を実装
- [x] calculate_max_speed(ball)メソッドを実装
- [x] SPEED_FACTOR = 0.85を定義
- [x] abs(ball.vy) * SPEED_FACTORを計算
- [x] MIN_SPEED = 100で最小速度を保証
- [x] テストを実行して成功することを確認

### 9. 更新処理のテストを作成
- [x] update()メソッドのテストを追加
- [x] パドルが正しい方向に移動することのテストを追加
- [x] 速度制限が適用されることのテストを追加
- [x] テストを実行して失敗することを確認

### 10. 更新処理を実装
- [x] update(ball, delta_time)メソッドを実装
- [x] get_movement_direction()で方向を取得
- [x] calculate_max_speed()で最大速度を取得
- [x] paddle.move_up/down()を呼び出し
- [x] テストを実行して成功することを確認

### 11. 予測機能のテストを作成（オプション）
- [x] predict_ball_position()メソッドのテストを追加
- [x] 将来のボール位置予測テストを追加
- [x] テストを実行して失敗することを確認

### 12. 予測機能を実装（オプション）
- [x] predict_ball_position(ball, time_ahead)メソッドを実装
- [x] 現在の速度から将来位置を計算
- [x] 壁反射を考慮した予測を実装
- [x] テストを実行して成功することを確認

### 13. 難易度調整のテストを作成
- [x] set_difficulty()メソッドのテストを追加
- [x] EASY/NORMAL/HARDレベルのテストを追加
- [x] テストを実行して失敗することを確認

### 14. 難易度調整を実装
- [x] set_difficulty(level)メソッドを実装
- [x] DifficultyLevel列挙型を定義
- [x] レベルに応じてSPEED_FACTORを調整（0.7/0.85/1.0）
- [x] 全テストを実行して成功することを確認

## 完了条件
- [x] CPUパドルがボールを自動追従する
- [x] 速度制限により適度な難易度になる
- [x] スムーズで自然な動きをする
- [x] pytest tests/test_cpu_controller.pyが全てパスする