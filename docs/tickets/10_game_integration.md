# チケット: 最終統合とゲームループ

## 概要
全てのコンポーネントを統合し、完全に動作するテニスゲームを完成させる。

## 実装内容
- 全コンポーネントの統合
- メインゲームループの完成
- 画面描画の実装
- ゲームフローの実装

## ToDo（TDD実装順）

### 1. TennisGameクラスのテストを作成
- [x] tests/test_tennis_game.pyを作成
- [x] TennisGameクラスの存在テストを記述
- [x] 初期化テストを追加
- [x] テストを実行して失敗することを確認

### 2. TennisGameクラスの基本実装
- [x] src/game/tennis_game.pyを作成
- [x] TennisGameクラスを定義
- [x] __init__メソッドで全コンポーネントを初期化
- [x] テストを実行して成功することを確認

### 3. コンポーネント初期化のテストを作成
- [x] initialize_components()メソッドのテストを追加
- [x] 各コンポーネントの存在確認テストを追加
- [x] テストを実行して失敗することを確認

### 4. コンポーネント初期化を実装
- [x] initialize_components()メソッドを実装
- [x] GameWindowの初期化
- [x] Paddle（プレイヤー、CPU）の作成
- [x] Ballの作成
- [x] ScoreManager、GameTimer、GameStateの初期化
- [x] InputHandler、CPUController、CollisionHandlerの初期化
- [x] テストを実行して成功することを確認

### 5. ゲーム更新処理のテストを作成
- [x] update()メソッドのテストを追加
- [x] delta_timeによる更新テストを追加
- [x] 各コンポーネントの更新確認テストを追加
- [x] テストを実行して失敗することを確認

### 6. ゲーム更新処理を実装
- [x] update(delta_time)メソッドを実装
- [x] 入力処理の更新
- [x] ゲーム状態に応じた処理分岐
- [x] プレイ中の場合の更新処理
- [x] テストを実行して成功することを確認

### 7. プレイ中更新のテストを作成
- [x] update_playing()メソッドのテストを追加
- [x] タイマー更新のテストを追加
- [x] エンティティ更新のテストを追加
- [x] 衝突判定のテストを追加
- [x] テストを実行して失敗することを確認

### 8. プレイ中更新を実装
- [x] update_playing(delta_time)メソッドを実装
- [x] タイマーの更新と終了判定
- [x] プレイヤーパドルの入力処理
- [x] CPUパドルのAI更新
- [x] ボールの移動更新
- [x] 衝突判定と反射処理
- [x] 得点判定とスコア更新
- [x] テストを実行して成功することを確認

### 9. 描画処理のテストを作成
- [x] render()メソッドのテストを追加
- [x] 画面クリアのテストを追加
- [x] 各要素の描画確認テストを追加
- [x] テストを実行して失敗することを確認

### 10. 描画処理を実装
- [x] render()メソッドを実装
- [x] 画面を黒でクリア
- [x] パドルとボールの描画
- [x] 中央線の描画
- [x] スコアとタイマーの表示
- [x] ゲーム状態メッセージの表示
- [x] pygame.display.flip()の呼び出し
- [x] テストを実行して成功することを確認

### 11. テキスト描画のテストを作成
- [x] draw_text()メソッドのテストを追加
- [x] フォントサイズのテストを追加
- [x] 位置指定のテストを追加
- [x] テストを実行して失敗することを確認

### 12. テキスト描画を実装
- [x] draw_text()メソッドを実装
- [x] pygame.font.Font()でフォント作成
- [x] render()でテキストサーフェス生成
- [x] 指定位置への描画
- [x] テストを実行して成功することを確認

### 13. メインループのテストを作成
- [x] run()メソッドのテストを追加
- [x] FPS制御のテストを追加
- [x] ゲームループの終了条件テストを追加
- [x] テストを実行して失敗することを確認

### 14. メインループを実装
- [x] run()メソッドを実装
- [x] pygame.time.Clock()でFPS制御
- [x] whileループでゲーム実行
- [x] update()とrender()の呼び出し
- [x] 終了条件の処理
- [x] テストを実行して成功することを確認

### 15. main.py統合のテストを作成
- [x] tests/test_main_integration.pyを作成
- [x] main関数の存在テストを追加
- [x] ゲーム起動のテストを追加
- [x] テストを実行して失敗することを確認

### 16. main.py統合を実装
- [x] main.pyを更新
- [x] TennisGameのインポート
- [x] main()関数の実装
- [x] game.run()の呼び出し
- [x] 全テストを実行して成功することを確認

## 完了条件
- [x] ゲームが起動し、黒い画面が表示される
- [x] Enterキーでゲームが開始される
- [x] パドルとボールが正しく動作する
- [x] スコアとタイマーが表示・更新される
- [x] 60秒でゲームオーバーになる
- [x] pytest tests/が全てパスする
- [x] python main.pyでゲームが実行できる