# チケット: 最終統合とゲームループ

## 概要
全てのコンポーネントを統合し、完全に動作するテニスゲームを完成させる。

## 実装内容
- 全コンポーネントの統合
- メインゲームループの完成
- 画面描画の実装
- ゲームフローの実装

## ToDo（TDD実装順）

### 1. TennisGameクラスのテストを作成
- [ ] tests/test_tennis_game.pyを作成
- [ ] TennisGameクラスの存在テストを記述
- [ ] 初期化テストを追加
- [ ] テストを実行して失敗することを確認

### 2. TennisGameクラスの基本実装
- [ ] src/game/tennis_game.pyを作成
- [ ] TennisGameクラスを定義
- [ ] __init__メソッドで全コンポーネントを初期化
- [ ] テストを実行して成功することを確認

### 3. コンポーネント初期化のテストを作成
- [ ] initialize_components()メソッドのテストを追加
- [ ] 各コンポーネントの存在確認テストを追加
- [ ] テストを実行して失敗することを確認

### 4. コンポーネント初期化を実装
- [ ] initialize_components()メソッドを実装
- [ ] GameWindowの初期化
- [ ] Paddle（プレイヤー、CPU）の作成
- [ ] Ballの作成
- [ ] ScoreManager、GameTimer、GameStateの初期化
- [ ] InputHandler、CPUController、CollisionHandlerの初期化
- [ ] テストを実行して成功することを確認

### 5. ゲーム更新処理のテストを作成
- [ ] update()メソッドのテストを追加
- [ ] delta_timeによる更新テストを追加
- [ ] 各コンポーネントの更新確認テストを追加
- [ ] テストを実行して失敗することを確認

### 6. ゲーム更新処理を実装
- [ ] update(delta_time)メソッドを実装
- [ ] 入力処理の更新
- [ ] ゲーム状態に応じた処理分岐
- [ ] プレイ中の場合の更新処理
- [ ] テストを実行して成功することを確認

### 7. プレイ中更新のテストを作成
- [ ] update_playing()メソッドのテストを追加
- [ ] タイマー更新のテストを追加
- [ ] エンティティ更新のテストを追加
- [ ] 衝突判定のテストを追加
- [ ] テストを実行して失敗することを確認

### 8. プレイ中更新を実装
- [ ] update_playing(delta_time)メソッドを実装
- [ ] タイマーの更新と終了判定
- [ ] プレイヤーパドルの入力処理
- [ ] CPUパドルのAI更新
- [ ] ボールの移動更新
- [ ] 衝突判定と反射処理
- [ ] 得点判定とスコア更新
- [ ] テストを実行して成功することを確認

### 9. 描画処理のテストを作成
- [ ] render()メソッドのテストを追加
- [ ] 画面クリアのテストを追加
- [ ] 各要素の描画確認テストを追加
- [ ] テストを実行して失敗することを確認

### 10. 描画処理を実装
- [ ] render()メソッドを実装
- [ ] 画面を黒でクリア
- [ ] パドルとボールの描画
- [ ] 中央線の描画
- [ ] スコアとタイマーの表示
- [ ] ゲーム状態メッセージの表示
- [ ] pygame.display.flip()の呼び出し
- [ ] テストを実行して成功することを確認

### 11. テキスト描画のテストを作成
- [ ] draw_text()メソッドのテストを追加
- [ ] フォントサイズのテストを追加
- [ ] 位置指定のテストを追加
- [ ] テストを実行して失敗することを確認

### 12. テキスト描画を実装
- [ ] draw_text()メソッドを実装
- [ ] pygame.font.Font()でフォント作成
- [ ] render()でテキストサーフェス生成
- [ ] 指定位置への描画
- [ ] テストを実行して成功することを確認

### 13. メインループのテストを作成
- [ ] run()メソッドのテストを追加
- [ ] FPS制御のテストを追加
- [ ] ゲームループの終了条件テストを追加
- [ ] テストを実行して失敗することを確認

### 14. メインループを実装
- [ ] run()メソッドを実装
- [ ] pygame.time.Clock()でFPS制御
- [ ] whileループでゲーム実行
- [ ] update()とrender()の呼び出し
- [ ] 終了条件の処理
- [ ] テストを実行して成功することを確認

### 15. main.py統合のテストを作成
- [ ] tests/test_main_integration.pyを作成
- [ ] main関数の存在テストを追加
- [ ] ゲーム起動のテストを追加
- [ ] テストを実行して失敗することを確認

### 16. main.py統合を実装
- [ ] main.pyを更新
- [ ] TennisGameのインポート
- [ ] main()関数の実装
- [ ] game.run()の呼び出し
- [ ] 全テストを実行して成功することを確認

## 完了条件
- [ ] ゲームが起動し、黒い画面が表示される
- [ ] Enterキーでゲームが開始される
- [ ] パドルとボールが正しく動作する
- [ ] スコアとタイマーが表示・更新される
- [ ] 60秒でゲームオーバーになる
- [ ] pytest tests/が全てパスする
- [ ] python main.pyでゲームが実行できる